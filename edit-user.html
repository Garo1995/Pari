<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <title></title>
</head>
<body>
<header>
    <div class="container">
        <div class="header-main">
            <a href="./index.html" class="header-logo">
                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                     id="Layer_1" x="0px" y="0px" viewBox="0 0 240 50"
                     xml:space="preserve">
                <style type="text/css">
                    .st2 {
                        fill: #FFFFFF;
                    }

                    .st1 {
                        fill: #00C7B1;
                    }
                </style>
                    <path class="st2"
                          d="M215.5,0c-2.8,0-5.3,1.8-6.2,4.5L194.8,49h13.7l13.2-40.5C223,4.3,219.9,0,215.5,0z"></path>
                    <path class="st1"
                          d="M120.8,1H78l-3.9,12h30L65.4,39c-3,2-3.5,6.1-1.2,8.8c2,2.4,5.4,2.8,8,1.1l39-26.2L102.6,49h13.7l12.2-37.5  C130.1,6.3,126.3,1,120.8,1z"></path>
                    <path class="st2"
                          d="M15.6,1L0,49h13.7l11.7-36h27.9l-19,12.8c-2.8,1.9-3.7,5.6-1.8,8.4c1.9,2.8,5.6,3.5,8.4,1.7l23.7-16  C73,14.2,69,1,58.8,1H15.6z"></path>
                    <path class="st2"
                          d="M187.8,1h-43.1L129,49h13.7l11.7-36h27.9l-24.7,16.7l15.3,18.2c2,2.4,5.4,2.8,8,1.1c3-2,3.5-6.1,1.2-8.8l-6.7-8  L193.6,20C202,14.2,198,1,187.8,1z"></path>
                </svg>
            </a>
            <div class="header-menu">
                <ul>
                    <li><a href="#">Спорт</a></li>
                    <li><a href="#">Live</a></li>
                    <li><a href="./quick-games.html">Игры 24/7</a></li>
                </ul>
            </div>
            <div class="head-hrefs-flex">
                <a class="head-hrefs stock-href" href="#">
                    <div class="stock-href-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" color="currentColor" width="14" height="14"
                             viewBox="0 0 16 16" fill="none">
                            <path d="M8.33366 8.33355H13.667V14.5002C13.667 14.6328 13.6143 14.76 13.5205 14.8538C13.4268 14.9475 13.2996 15.0002 13.167 15.0002H8.83366C8.70105 15.0002 8.57387 14.9475 8.48011 14.8538C8.38634 14.76 8.33366 14.6328 8.33366 14.5002V8.33355Z"
                                  fill="currentColor"></path>
                            <path d="M2.00033 8.33355H7.33366V14.5002C7.33366 14.6328 7.28098 14.76 7.18721 14.8538C7.09344 14.9475 6.96627 15.0002 6.83366 15.0002H2.50033C2.36772 15.0002 2.24054 14.9475 2.14677 14.8538C2.053 14.76 2.00033 14.6328 2.00033 14.5002V8.33355Z"
                                  fill="currentColor"></path>
                            <path d="M8.33366 4.00022H14.5003C14.6329 4.00022 14.7601 4.05289 14.8539 4.14666C14.9476 4.24043 15.0003 4.36761 15.0003 4.50022V7.33355H8.33366V4.00022Z"
                                  fill="currentColor"></path>
                            <path d="M7.33366 7.33355H0.666992V4.50688C0.666992 4.37427 0.719671 4.2471 0.813439 4.15333C0.907207 4.05956 1.03438 4.00688 1.16699 4.00688H7.33366V7.33355Z"
                                  fill="currentColor"></path>
                            <path d="M12.347 1.33355C12.1483 1.1264 11.9104 0.960796 11.6472 0.846351C11.384 0.731905 11.0003 0.657044 10.8137 0.666882C10.213 0.698525 9.63261 0.89508 9.13631 1.23496C8.64001 1.57484 8.24696 2.04491 8.00033 2.59355C7.93366 2.72022 7.86699 2.84022 7.81366 2.96022C7.76033 2.84022 7.69366 2.71355 7.62699 2.59355C7.38035 2.04491 6.98731 1.57484 6.49101 1.23496C5.99471 0.89508 5.40392 0.665319 4.81366 0.666882C4.42555 0.667909 4.04483 0.773169 3.71131 0.97166C3.3778 1.17015 3.10372 1.45458 2.91772 1.79523C2.73173 2.13587 2.64066 2.52023 2.65401 2.90811C2.66737 3.296 2.79132 3.68619 3.0003 4.01324H4.00033H4.87366C4.56424 4.01324 4.26749 3.8773 4.0487 3.65851C3.82991 3.43971 3.70699 3.14297 3.70699 2.83355C3.70699 2.52413 3.82991 2.22738 4.0487 2.00859C4.26749 1.7898 4.56424 1.66688 4.87366 1.66688C5.33364 1.66688 5.70018 1.8474 6.04268 2.09574C6.38518 2.34408 6.65207 2.68257 6.81366 3.07355C6.97342 3.37034 7.10725 3.68039 7.21366 4.00022H8.47366C8.58003 3.68037 8.71386 3.37033 8.87366 3.07355C9.03525 2.68257 9.30214 2.34408 9.64464 2.09574C9.98714 1.8474 10.3918 1.69894 10.8137 1.66688C11.1231 1.66688 11.4198 1.7898 11.6386 2.00859C11.8574 2.22738 11.9803 2.52413 11.9803 2.83355C11.9803 3.14297 11.8574 3.43971 11.6386 3.65851C11.4198 3.8773 11.1231 4.00022 10.8137 4.00022H12.667C12.9247 3.58737 13.0359 3.09978 12.9827 2.61602C12.9295 2.13226 12.6883 1.68051 12.347 1.33355Z"
                                  fill="currentColor"></path>
                        </svg>
                    </div>
                    <span>Акции</span>
                </a>
                <span class="line-head"></span>
                <span class="head-hrefs box-help">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                              d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16ZM5.428 3.732c-.598.607-.929 1.447-.994 2.52h2.044C6.515 5.104 7 4.53 7.934 4.53c.364 0 .653.103.868.308.224.205.336.476.336.812 0 .168-.024.322-.07.462-.047.14-.126.275-.238.406-.112.13-.206.233-.28.308-.075.075-.201.182-.378.322-.178.14-.294.233-.35.28-.43.364-.7.723-.812 1.078-.103.345-.154.845-.154 1.498h1.862c0-.485.06-.835.182-1.05.121-.224.387-.476.798-.756.504-.345.891-.714 1.162-1.106.28-.392.42-.859.42-1.4 0-.859-.304-1.55-.91-2.072-.607-.532-1.41-.798-2.408-.798-1.092 0-1.937.303-2.534.91ZM8.858 13v-2.142h-2.17V13h2.17Z"
                              fill="currentColor"></path>
                    </svg>
                    <span>Помощь</span>
                </span>
                <span class="line-head"></span>
                <span class="head-hrefs head-search">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                         viewBox="0 0 210 210" style="enable-background:new 0 0 210 210;" xml:space="preserve">
                        <style type="text/css">
                            .st0 {
                                fill: currentColor;
                            }
                        </style>
                            <g>
                            <path class="st0"
                                  d="M90,30c33.1,0,60,26.9,60,60s-26.9,60-60,60s-60-26.9-60-60S56.9,30,90,30 M90,0C40.3,0,0,40.3,0,90   s40.3,90,90,90s90-40.3,90-90S139.7,0,90,0L90,0z"></path>
                        </g>
                            <rect x="154" y="126.5" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -70.0638 169.1491)"
                                  class="st0" width="30.3" height="85.3"></rect>
                        </svg>
                </span>
                <span class="head-hrefs settings">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 210 210" xml:space="preserve">
                        <path class="icon-settings_svg__st0"
                              d="M180.5 92.3c-.8-4.5-1.8-9.1-3.5-13.5-1.6-4.4-3.7-8.6-6-12.6l19.3-22.8-39-32.6-19.3 23c-8.7-3.2-18-4.8-27.5-4.7l-10.1-28-48.1 17.5 10.1 27.9c-7.2 6-13.3 13.2-18 21.3L9 62.7l-9 49.9 29.5 5.1c.8 4.5 1.8 9 3.5 13.4 1.6 4.4 3.7 8.6 6 12.6l-19.3 22.9 39 32.5L78 176.2c8.7 3.2 18 4.8 27.5 4.7l10.1 27.9 48-17.5-10.1-27.9c7.3-6 13.4-13.2 18.1-21.3l29.5 5.1 9-49.9-29.6-5zm-62.6 48.4c-19.9 7.2-41.8-2.9-49-22.6s3.2-41.5 23-48.8c19.9-7.2 41.8 2.9 49 22.6 7.3 19.7-3.1 41.5-23 48.8z"
                              fill="currentColor"></path>
                    </svg>
                </span>
            </div>
            <div class="header-btn">
                <button data-val="modal-login" class="open_modal btn-login">Войти</button>
                <a href="./registration.html" class="btn-register">Регистрация</a>
            </div>

        </div>
    </div>
</header>

<section class="cabinet-pages">
    <div class="container">
        <div class="cabinet-tab">
            <div id="user-edit-page">
                <h2>Редактирование профиля пользователя</h2>

                <div class="edit-user-cnt">
                    <div class="modal-inp">
                        <label>Имя:</label>
                        <input type="text" id="user-name"/>
                    </div>
                    <div class="modal-inp">
                        <label>Email:</label>
                        <input type="email" id="user-email"/>
                    </div>
                    <div class="modal-inp">
                        <label>Пароль (новый):</label>
                        <input type="password" id="user-password"/>
                    </div>
                    <button class="btn-register" onclick="saveUserProfile()">Сохранить</button>
                </div>


                <div class="edit-user-cnt">
                    <h3>Баланс</h3>
                    <div class="modal-inp">
                        <input type="number" id="user-balance"/>
                    </div>
                    <button class="btn-register" onclick="updateBalance()">Изменить баланс</button>
                </div>


                <div class="edit-user-cnt">
                    <h3>Ставки</h3>
                    <button class="btn-register" onclick="createBet()">Добавить ставку</button>

                    <div class="tab-user">
                        <table id="bets-table">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Коэффициент</th>
                                <th>Сумма</th>
                                <th>Дата</th>
                                <th>Статус</th>
                                <th>Выигрыш</th>
                                <th>Действия</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>


                <!-- История -->
                <div class="edit-user-cnt">
                    <h3>История операций</h3>
                    <div class="modal-inp">
                        <textarea id="new-history-message" placeholder="Новое сообщение"></textarea>
                    </div>
                    <button class="btn-register" onclick="addHistory()">Добавить в историю</button>
                    <ul id="history-list"></ul>
                </div>


                <!-- Документы -->
                <div class="edit-user-cnt">
                    <h3>Документы</h3>
                    <ul id="documents-list"></ul>
                </div>


                <!-- Действия -->
                <div class="edit-user-cnt">
                    <h3>Действия</h3>

                    <div class="actions-flex">
                        <div class="registration-check">
                            <label class="check-lab">
                                <input type="checkbox" id="bets-enabled" onchange="toggleBets()"> Включить ставки
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <div class="registration-check">
                            <label class="check-lab">
                                <input type="checkbox" id="verif-status" onchange="toggleVerification()"> Пользователь
                                верифицирован
                                <span class="checkmark"></span>
                            </label>
                        </div>
                    </div>

                    <button class="person-send" onclick="deleteUser()">Удалить пользователя</button>
                </div>
            </div>
        </div>
    </div>
</section>


<script src="assets/js/jquery-3.6.4.js"></script>
<script src="assets/js/jquery.mask.js"></script>
<script src="assets/js/jquery.formstyler.min.js"></script>
<script src="assets/js/swiper-bundle.min.js"></script>
<script src="assets/js/script.js"></script>

<script>
    let userId = 12345; // <-- заменишь на реальный ID из URL или контекста

    async function loadUserData() {
        // Получение информации о пользователе
        const res = await fetch(`/api/user/${userId}`);
        const user = await res.json();

        document.getElementById('user-name').value = user.name;
        document.getElementById('user-email').value = user.email;
        document.getElementById('user-balance').value = (user.balance / 100).toFixed(2);
        document.getElementById('bets-enabled').checked = user.bet_enabled;
        document.getElementById('verif-status').checked = user.verif_status === 'enabled';

        loadBets();
        loadHistory();
        loadDocuments();
    }

    async function saveUserProfile() {
        const body = {
            name: document.getElementById('user-name').value,
            email: document.getElementById('user-email').value,
            password: document.getElementById('user-password').value || undefined
        };
        await fetch(`/api/user/${userId}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(body)
        });
        alert("Данные обновлены");
    }

    async function updateBalance() {
        const balance = parseFloat(document.getElementById('user-balance').value) * 100;
        await fetch(`/api/user/${userId}/balance`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({balance})
        });
        alert("Баланс обновлён");
    }

    async function toggleBets() {
        const enabled = document.getElementById('bets-enabled').checked;
        await fetch(`/api/user/${userId}/bets-enabled`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({enabled})
        });
    }

    async function toggleVerification() {
        const verified = document.getElementById('verif-status').checked;
        await fetch(`/api/user/${userId}/verification`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({verified})
        });
    }

    async function deleteUser() {
        if (confirm("Удалить пользователя?")) {
            await fetch(`/api/user/${userId}`, {method: 'DELETE'});
            alert("Пользователь удалён");
            // redirect logic
        }
    }

    async function loadBets() {
        const res = await fetch(`/api/user/${userId}/bets`);
        const bets = await res.json();
        const tbody = document.querySelector('#bets-table tbody');
        tbody.innerHTML = '';
        bets.forEach(bet => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
        <td>${bet.id}</td>
        <td>${bet.odds}</td>
        <td>${bet.amount}</td>
        <td>${new Date(bet.date * 1000).toLocaleDateString()}</td>
        <td>${bet.status}</td>
        <td>${bet.win}</td>
        <td>
          <button onclick="editBet(${bet.id})">✏️</button>
          <button onclick="deleteBet(${bet.id})">❌</button>
        </td>
      `;
            tbody.appendChild(tr);
        });
    }

    async function createBet() {
        // здесь будет логика создания новой ставки (например через prompt или модальное окно)
    }

    async function editBet(id) {
        // логика редактирования ставки
    }

    async function deleteBet(id) {
        if (confirm("Удалить ставку?")) {
            await fetch(`/api/user/${userId}/bets/${id}`, {method: 'DELETE'});
            loadBets();
        }
    }

    async function loadHistory() {
        const res = await fetch(`/api/user/${userId}/history`);
        const history = await res.json();
        const list = document.getElementById('history-list');
        list.innerHTML = '';
        history.forEach(msg => {
            const li = document.createElement('li');
            li.innerHTML = `
        ${msg.message}
        <button onclick="editHistory(${msg.id})">✏️</button>
        <button onclick="deleteHistory(${msg.id})">❌</button>
      `;
            list.appendChild(li);
        });
    }

    async function addHistory() {
        const message = document.getElementById('new-history-message').value;
        await fetch(`/api/user/${userId}/history`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({message})
        });
        document.getElementById('new-history-message').value = '';
        loadHistory();
    }

    async function editHistory(id) {
        const newMsg = prompt("Новое сообщение:");
        if (!newMsg) return;
        await fetch(`/api/user/${userId}/history/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({message: newMsg})
        });
        loadHistory();
    }

    async function deleteHistory(id) {
        if (confirm("Удалить запись из истории?")) {
            await fetch(`/api/user/${userId}/history/${id}`, {method: 'DELETE'});
            loadHistory();
        }
    }

    async function loadDocuments() {
        const res = await fetch(`/api/user/${userId}/documents`);
        const docs = await res.json();
        const list = document.getElementById('documents-list');
        list.innerHTML = '';
        docs.forEach(doc => {
            const li = document.createElement('li');
            li.innerHTML = `
        ${doc.name}
        <button onclick="downloadDoc('${doc.id}')">📄</button>
        <button onclick="deleteDoc('${doc.id}')">❌</button>
      `;
            list.appendChild(li);
        });
    }

    async function downloadDoc(id) {
        window.open(`/api/user/${userId}/documents/${id}`, '_blank');
    }

    async function deleteDoc(id) {
        if (confirm("Удалить файл?")) {
            await fetch(`/api/user/${userId}/documents/${id}`, {method: 'DELETE'});
            loadDocuments();
        }
    }

    // Загружаем пользователя при открытии страницы
    loadUserData();

</script>


</body>
</html>
